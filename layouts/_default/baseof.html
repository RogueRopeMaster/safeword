<!doctype html>
<html lang="{{ .Site.Language.LanguageCode | default .Site.Language.Lang }}"{{ if .Site.Params.rtl }} dir="rtl"{{ end }}>
<head>
  <title>{{ block "title" . }}{{ .Site.Title }}{{ end }}</title>
  {{ partial "head.html" . }}
</head>
{{ $scheme := .Site.Params.colorScheme | default "dark" }}
<body class="site{{ if or (eq $scheme "dark") (eq $scheme "auto") }} colorscheme-dark{{ else }} colorscheme-light{{ end }}{{ if .Site.Params.rtl }} rtl{{ end }}">
  <a class="skip-link" href="#main-content">{{ i18n "skip_to_content" | default "Skip to content" }}</a>
  <main class="wrapper">
    {{ partial "header.html" . }}

    <div class="content" id="main-content">
      {{ block "content" . }}{{ end }}
    </div>

    {{ partial "footer.html" . }}
  </main>

  {{ if .HasShortcode "mermaid" }}
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js" defer></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (window.mermaid) {
          window.mermaid.initialize({ startOnLoad: true, theme: "dark" });
        }
      });
    </script>
  {{ end }}

  {{ with resources.Get "js/site.js" }}
    {{ $script := . }}
    {{ if hugo.IsProduction }}
      {{ $script = $script | minify | fingerprint }}
    {{ end }}
    <script src="{{ $script.RelPermalink }}"{{ with $script.Data.Integrity }} integrity="{{ . }}" crossorigin="anonymous"{{ end }} defer></script>
  {{ end }}

  {{ range .Site.Params.customJS }}
    {{ with resources.Get . }}
      {{ $customScript := . }}
      {{ if hugo.IsProduction }}
        {{ $customScript = $customScript | minify | fingerprint }}
      {{ end }}
      <script src="{{ $customScript.RelPermalink }}"{{ with $customScript.Data.Integrity }} integrity="{{ . }}" crossorigin="anonymous"{{ end }} defer></script>
    {{ end }}
  {{ end }}

  {{ range .Site.Params.customRemoteJS }}
    <script src="{{ . | safeURL }}" defer></script>
  {{ end }}

  {{ template "_internal/google_analytics.html" . }}
</body>
</html>
